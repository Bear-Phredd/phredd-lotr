var rubicontag=rubicontag||{};rubicontag.video=rubicontag.video||function(){var t={slots:{},getAllSlots:function(){var t=[];for(var n in this.slots)this.slots.hasOwnProperty(n)&&t.push(this.slots[n]);return t},defineSlot:function(t,n){function e(t,n){this.id=t,this.definition=n,this._is_ready=!1,this.rawResponses=[]}var s=new e(t,n);this.slots[t]=s,e.prototype.getAds=function(){for(var t=[],n=this.getRawResponses(),e=0;e<n.length;++e)t=t.concat(n[e].ads);return t},e.prototype.getBestCpm=function(){var t=this.getAds();return t.sort(function(t,n){return t.cpm<n.cpm?1:t.cpm>n.cpm?-1:0}),t[0]},e.prototype.getRawResponses=function(){return this.rawResponses}},_sendRequest:function(t){var n="?";for(var e in t.definition)t.definition.hasOwnProperty(e)&&(n+="&"+e+"="+encodeURIComponent(t.definition[e]));n=n.replace(/^\?&/,"?");var s=new window.XMLHttpRequest;s.open("GET",["http:"===window.location.protocol?"http:":"https:","//","thm.aws.rubiconproject.com","/fastlane/vulcan",n].join(""),!0),s.onreadystatechange=function(){if(4===s.readyState&&(t._is_ready=!0,200===s.status)){var n=JSON.parse(s.responseText);t.rawResponses.push(n)}},s.send()},run:function(t){for(var n=this.getAllSlots(),e=0;e<n.length;++e)this._sendRequest(n[e]);this._wait(t)},_wait:function(t){for(var n=this.getAllSlots(),e=[],s=0;s<n.length;++s)e[s]=!!n[s].rawResponses.length;var o=!0;for(s=0;s<e.length;++s)o=o&&e[s];o?t():setTimeout(this._wait.bind(this),75,t)}};return t}();